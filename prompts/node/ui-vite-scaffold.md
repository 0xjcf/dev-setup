# üì¶ Node.js UI Scaffolding (Vite + React Focus)

## üéØ Objective
Create a modern Node.js UI project using Vite and React, bootstrapped via our script which leverages the official Vite CLI, applies standardized configurations, and includes Docker support.

## üìù Purpose in MVP_Kit
This scaffold provides one of the potential **blueprints for the `mvp-prototyping-system`**. It enables rapid development of:
- Interactive web application prototypes for client MVPs.
- PWAs (Progressive Web Apps) with local storage capabilities (e.g., IndexedDB).
- Client-side applications using the Vite/React ecosystem.

## üìã Requirements

### 1. Project Initialization (Handled by `bootstrap.sh`)
```bash
# The bootstrap script executes the following steps for Vite:
# 1. Runs `pnpm create vite@latest . --template react-ts`
# 2. Installs additional dev dependencies: `@biomejs/biome vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom`
# 3. Copies shared templates (`.gitignore`, `biome.json.tpl`) - overwrites if needed.
# 4. Copies Vite-specific templates from `templates/node/vite/` (e.g., App.test.tsx.tpl, setup.ts.tpl, main.tsx.tpl, App.tsx.tpl, vite.config.ts.tpl, tsconfig*.json.tpl, Dockerfile.tpl, docker-compose.yml.tpl) - overwrites if needed.
# 5. Processes templates using `envsubst` (if variables are defined in metadata).
# 6. Updates `package.json` scripts (format, lint, test, build, dev, preview).
```

### 2. Directory Structure (Generated by Vite + Templates)
```
ui/ # Example project root name
‚îú‚îÄ‚îÄ docker/            # Contains Dockerfile.tpl, docker-compose.yml.tpl (in templates)
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ vite.svg       # Example static asset
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ react.svg  # Example project asset
‚îÇ   ‚îú‚îÄ‚îÄ components/    # Empty dir for user components
‚îÇ   ‚îú‚îÄ‚îÄ lib/           # Empty dir for user libs
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ setup.ts   # Imports jest-dom matchers (template: src/tests/setup.ts.tpl)
‚îÇ   ‚îú‚îÄ‚îÄ App.css        # Default styles
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx        # Main application component (template: src/App.tsx.tpl)
‚îÇ   ‚îú‚îÄ‚îÄ App.test.tsx   # Example test for App (template: src/App.test.tsx.tpl)
‚îÇ   ‚îú‚îÄ‚îÄ index.css      # Default global styles
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx       # Entry point (template: src/main.tsx.tpl)
‚îÇ   ‚îî‚îÄ‚îÄ vite-env.d.ts  # Vite TS declarations
‚îú‚îÄ‚îÄ .gitignore         # Generated by Vite (or copied from shared)
‚îú‚îÄ‚îÄ biome.json         # Biome configuration (copied from shared template)
‚îú‚îÄ‚îÄ Dockerfile         # Generated from template
‚îú‚îÄ‚îÄ docker-compose.yml # Generated from template
‚îú‚îÄ‚îÄ index.html         # HTML entry point (generated by create-vite)
‚îú‚îÄ‚îÄ package.json       # Project configuration (modified by bootstrap script)
‚îú‚îÄ‚îÄ pnpm-lock.yaml     # Generated by pnpm
‚îú‚îÄ‚îÄ README.md          # Generated by Vite
‚îú‚îÄ‚îÄ tsconfig.app.json  # App-specific TS config (template: tsconfig.app.json.tpl)
‚îú‚îÄ‚îÄ tsconfig.json      # Root TS config (template: tsconfig.json.tpl)
‚îú‚îÄ‚îÄ tsconfig.node.json # TS config for Node context (generated by create-vite, ignored by Biome)
‚îî‚îÄ‚îÄ vite.config.ts     # Vite configuration (template: vite.config.ts.tpl)
# Note: node_modules/ is generated.
# Note: dist/ is the build output directory.
```

### 3. Configuration Files

- **`package.json`**: Initially generated by `create-vite`, then modified by `bootstrap.sh` to add/update scripts (dev, build, preview, test, lint, format).
- **`Dockerfile`**: Copied from `templates/node/vite/docker/Dockerfile.tpl`. Defines multi-stage builds for dev, test, and production (Nginx).
- **`docker-compose.yml`**: Copied from `templates/node/vite/docker/docker-compose.yml.tpl`. Defines `dev`, `test`, and `preview` services using the Dockerfile stages. Uses `${port}` variable.
- **`nginx.conf`**: Copied from `templates/node/vite/docker/nginx.conf.tpl`. Configures Nginx for the production stage, including SPA routing.
- **`vite.config.ts`**: Copied from `templates/node/vite/vite.config.ts.tpl`, includes Vitest config and `server.host = true`.
- **`tsconfig.json`**: Copied from `templates/node/vite/tsconfig.json.tpl`, references app/node configs.
- **`tsconfig.app.json`**: Copied from `templates/node/vite/tsconfig.app.json.tpl`, includes app settings and test types.
- **`tsconfig.node.json`**: Generated by `create-vite`, used for `vite.config.ts` processing, ignored by Biome.
- **`biome.json`**: Copied from `templates/node/shared/biome.json.tpl`, includes ignore patterns for tsconfig files.
- **`index.html`**: The HTML entry point generated by `create-vite`.

### 4. Example Implementation (Templates Used)
See `templates/node/vite/src/main.tsx.tpl` and `templates/node/vite/src/App.tsx.tpl`.

### 5. Test Implementation (Templates Used)
See `templates/node/vite/src/App.test.tsx.tpl` and `templates/node/vite/src/tests/setup.ts.tpl`.

### 6. Docker Configuration
```dockerfile
# See templates/node/vite/docker/Dockerfile.tpl
# Multi-stage: builder -> production (nginx) -> development -> test
```
```yaml
# See templates/node/vite/docker/docker-compose.yml.tpl
# Defines services: dev, test, preview
```

## üîß Implementation Steps

1.  **Bootstrap Project**
    ```bash
    # Run bootstrap script from dev-setup directory:
    ./bootstrap.sh --yes --tech=node --class=ui --framework=vite --output-dir=../bootstrap-test/node/test-ui-vite --project-name=test-ui-vite
    # Or via just:
    just bootstrap-ui-vite
    ```

2.  **Post-Processing (Handled by `bootstrap.sh` and `just` task)**
    - Project directory created.
    - `create-vite` executed.
    - Additional dependencies installed (`biome`, `vitest`, `jsdom`, etc.).
    - Shared & Vite-specific template files copied (incl. Dockerfiles, tsconfigs, src files, nginx.conf - overwriting Vite defaults where applicable).
    - `package.json` scripts updated.
    - Biome formatting and fixes applied (`biome format --write`, `biome check --write` via `just` task).
    - Specific test structure validation is skipped.

3.  **Development**
    ```bash
    # Navigate to project directory
    cd bootstrap-test/node/test-ui-vite

    # Start development server (local)
    pnpm dev

    # Start development server (Docker)
    # Ensure port 5173 (or custom via env var 'port') is free on host
    just docker-vite-dev # From workspace root

    # Start production preview server (Docker)
    # Ensure port 8080 (or custom via env var 'port') is free on host
    just docker-vite-preview # From workspace root

    # Run tests (local)
    pnpm test

    # Run tests (Docker)
    just docker-vite-test # From workspace root

    # Format code (local)
    pnpm format
    ```

## ‚úÖ Success Criteria (Verified)

1.  **Functionality**
    - [x] Vite development server starts successfully (`pnpm dev`, `just docker-vite-dev`).
    - [x] Hot module replacement works during development (local & Docker).
    - [x] Tests pass (local: `pnpm test` | Docker: `just docker-vite-test`).
    - [x] Linting passes (`pnpm biome check .`).
    - [x] Production preview starts and serves correctly (`just docker-vite-preview`).
    - [x] SPA routing works in production preview (tested manually).

2.  **Build Process**
    - [x] Project builds successfully (`pnpm build`).
    - [x] TypeScript declarations check passes during build.
    - [x] Docker image builds successfully (`just docker-vite-build`).

3.  **Configuration**
    - [x] `biome.json` is present and correctly configured.
    - [x] `package.json` includes necessary scripts (dev, build, preview, test, lint, format).
    - [x] `vite.config.ts` is present and configured for Vitest and Docker host.
    - [x] `tsconfig.app.json` includes test types.
    - [x] `Dockerfile` and `docker-compose.yml` are present and configured for dev/test/preview.
    - [x] `nginx.conf` is present and configured for SPA routing.

4.  **Dependencies**
    - [x] Core Vite and React dependencies are installed.
    - [x] Biome, Vitest, JSOM, and Testing Library (react, jest-dom, user-event) are installed.
    - [x] No major dependency conflicts apparent.

## üîç Testing

1.  **Local Testing**
    ```bash
    # From workspace root
    just test-ui-vite 
    # Or from project directory
    # cd bootstrap-test/node/test-ui-vite && pnpm test
    ```

2.  **Docker Testing**
    ```bash
    # From workspace root
    just docker-vite-build
    just docker-vite-test
    ```

3.  **Manual Integration Testing**
    - Run `pnpm dev` in the project directory OR `just docker-vite-dev` from root.
    - Access the site in a browser (localhost:5173 by default).
    - Make changes to components/pages and verify hot reload.
    - Run `just docker-vite-preview` from root.
    - Access the preview site in a browser (localhost:8080 by default).
    - Test SPA routing (refresh on different paths, direct access).
    - Run `pnpm build` and `pnpm preview` (local) to test local production build serving.

## üìù Notes

- This scaffold uses **Vite + React**.
- Testing is set up with **Vitest** and **React Testing Library**.
- **Biome** is used for linting and formatting.
- **Docker support is included** for development, testing, and production preview.
- Relies on **template files** in `templates/node/vite/` and `templates/node/shared/` for configuration and core files.
